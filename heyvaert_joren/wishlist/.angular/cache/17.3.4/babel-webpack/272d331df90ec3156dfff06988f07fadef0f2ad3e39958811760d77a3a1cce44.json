{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HEYVA/OneDrive - Thomas More/Documenten/School/School jaar 2024 - 2025/Web development/Labo/Eigen/Project/Wish-List-2.0/wishlist/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { Subject, from, map } from 'rxjs';\nimport { collection, collectionData, deleteDoc, doc, docData, Firestore, setDoc, updateDoc, writeBatch } from '@angular/fire/firestore';\nimport { getDownloadURL, ref, uploadBytesResumable, Storage, deleteObject } from '@angular/fire/storage';\nlet ItemService = class ItemService {\n  constructor(db, storage) {\n    this.db = db;\n    this.storage = storage;\n    this.items = [];\n    this.ItemsUpdated = new Subject();\n  }\n  getItems() {\n    return collectionData(collection(this.db, 'item'), {\n      idField: 'id'\n    });\n  }\n  getItemsnPut() {\n    this.getItems().subscribe({\n      next: respons => {\n        this.items = respons;\n        this.ItemsUpdated.next(this.items);\n      },\n      error: error => console.log('error: ', error)\n    });\n  }\n  getLastItems() {\n    return this.getItems().pipe(map(items => items.slice(-5)));\n  }\n  getItem(id) {\n    return docData(doc(this.db, 'item/' + id));\n  }\n  addItems(item, id) {\n    const itemRef = doc(this.db, 'item/', id);\n    return from(setDoc(itemRef, item));\n  }\n  deleteItem(item) {\n    const itemRef = doc(this.db, 'item/' + item.id);\n    // console.log(\"item: \" + item);\n    if (item.img) {\n      console.log(\"if\");\n      this.deleteImg(item.img);\n    }\n    return from(deleteDoc(itemRef));\n  }\n  updateItem(item, id) {\n    const itemRef = doc(this.db, 'item/' + id);\n    return updateDoc(itemRef, {\n      ...item\n    });\n  }\n  createItemId() {\n    const newID = doc(collection(this.db, 'item')).id;\n    return newID;\n  }\n  uploadImg(path, file) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const storageRef = ref(_this.storage, path);\n      const task = uploadBytesResumable(storageRef, file);\n      yield task;\n      const url = yield getDownloadURL(storageRef);\n      return url;\n    })();\n  }\n  deleteImg(img) {\n    const storageRef = ref(this.storage, img);\n    const batch = writeBatch(this.db);\n    return deleteObject(storageRef).then(() => {\n      batch.commit();\n    });\n  }\n  static #_ = this.ctorParameters = () => [{\n    type: Firestore\n  }, {\n    type: Storage\n  }];\n};\nItemService = __decorate([Injectable({\n  providedIn: 'root'\n})], ItemService);\nexport { ItemService };","map":{"version":3,"names":["Injectable","Subject","from","map","collection","collectionData","deleteDoc","doc","docData","Firestore","setDoc","updateDoc","writeBatch","getDownloadURL","ref","uploadBytesResumable","Storage","deleteObject","ItemService","constructor","db","storage","items","ItemsUpdated","getItems","idField","getItemsnPut","subscribe","next","respons","error","console","log","getLastItems","pipe","slice","getItem","id","addItems","item","itemRef","deleteItem","img","deleteImg","updateItem","createItemId","newID","uploadImg","path","file","_this","_asyncToGenerator","storageRef","task","url","batch","then","commit","_","__decorate","providedIn"],"sources":["C:\\Users\\HEYVA\\OneDrive - Thomas More\\Documenten\\School\\School jaar 2024 - 2025\\Web development\\Labo\\Eigen\\Project\\Wish-List-2.0\\wishlist\\src\\app\\item-component\\item.service.ts"],"sourcesContent":["/*Backend service*/\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, Subject, from, map, tap } from 'rxjs';\r\nimport { item } from './item.model';\r\nimport { collection, collectionData, CollectionReference, deleteDoc, doc, docData, DocumentReference, Firestore, setDoc, updateDoc, writeBatch } from '@angular/fire/firestore';\r\nimport { getDownloadURL, ref, uploadBytesResumable, Storage, deleteObject } from '@angular/fire/storage';\r\n\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ItemService {\r\n\r\n  items: item[] = [];\r\n  ItemsUpdated = new Subject<item[]>();\r\n\r\n\r\n\r\n  constructor(private db: Firestore, private storage : Storage) { }\r\n\r\n  getItems(): Observable<item[]> {\r\n    return collectionData<item>(\r\n      collection(this.db, 'item') as CollectionReference<item>,\r\n      { idField: 'id'}\r\n    )\r\n  }\r\n\r\n  getItemsnPut(): void {\r\n    this.getItems().subscribe({\r\n      next: (respons: item[]) => {\r\n        this.items = respons;\r\n        this.ItemsUpdated.next(this.items);\r\n      },\r\n      error: (error) => console.log('error: ', error)\r\n    });\r\n  }\r\n\r\n  getLastItems(): Observable<item[]> {\r\n    return this.getItems().pipe(\r\n      map(items => items.slice(-5))\r\n    );\r\n  }\r\n\r\n  getItem(id: string): Observable<item | undefined>{\r\n    return docData<item>(\r\n      doc(this.db, 'item/' + id) as DocumentReference<item>\r\n    );\r\n  }\r\n\r\n  addItems(item: item, id: string) {\r\n    const itemRef = doc(this.db, 'item/', id);\r\n    return from(setDoc(itemRef, item));\r\n  }\r\n\r\n  deleteItem(item: item) {\r\n    const itemRef = doc(this.db, 'item/' + item.id) as DocumentReference<item>;\r\n    // console.log(\"item: \" + item);\r\n    if (item.img){\r\n      console.log(\"if\");\r\n      this.deleteImg(item.img);\r\n    }\r\n    return from(deleteDoc(itemRef));\r\n  }\r\n\r\n  \r\n  updateItem(item: item, id: string):Promise <void> {\r\n    const itemRef = doc(this.db, 'item/' + id) as DocumentReference<item>;\r\n    return updateDoc(itemRef, {... item});\r\n  }\r\n\r\n  createItemId(){\r\n    const newID = doc(collection(this.db, 'item')).id;\r\n    return newID;\r\n  }\r\n\r\n  async uploadImg(path: string, file: File): Promise<string> {\r\n    const storageRef = ref(this.storage, path);\r\n    const task = uploadBytesResumable(storageRef, file);\r\n    await task;\r\n    const url = await getDownloadURL(storageRef);\r\n    return url;\r\n\r\n  }\r\n\r\n  deleteImg(img: string) {\r\n    const storageRef = ref(this.storage, img);\r\n    const batch = writeBatch(this.db);\r\n    return deleteObject(storageRef).then(() => {\r\n      batch.commit();\r\n    })\r\n  }\r\n\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}